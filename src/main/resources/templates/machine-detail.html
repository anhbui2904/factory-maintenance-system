<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>機械詳細</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>body { font-family: "Hiragino Kaku Gothic Pro", "Meiryo", sans-serif; }</style>
</head>
<body class="bg-light">

<div class="container mt-5">

    <!-- Nút quay lại -->
    <a href="/machines" class="btn btn-outline-secondary mb-3">
        ⬅ 一覧に戻る
    </a>

    <!-- Phần 1: Thông tin chung -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">ℹ 機械詳細情報</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>名称:</strong> <span th:text="${machine.name}" class="fs-5"></span></p>
                    <p><strong>管理コード:</strong> <span th:text="${machine.code}" class="fw-bold"></span></p>
                    <p><strong>モデル:</strong> <span th:text="${machine.model}"></span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>設置場所:</strong> <span th:text="${machine.location}"></span></p>
                    <p><strong>状態:</strong>
                        <span th:text="${machine.status == 'ACTIVE' ? '稼働中' : '点検中'}"
                              th:class="${machine.status == 'ACTIVE' ? 'badge bg-success' : 'badge bg-warning text-dark'}">
                       </span>
                    </p>
                    <p><strong>設置日:</strong> <span th:text="${machine.installDate}"></span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Phần 2: Lịch sử bảo trì (CÓ NÚT THÊM MỚI) -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="text-dark mb-0">🛠 メンテナンス履歴</h4>
        <!-- Nút bấm mở Form thêm mới -->
        <a th:href="@{/machines/{id}/log/add(id=${machine.id})}" class="btn btn-primary">
            + 記録を追加
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-dark">
                <tr>
                    <th>日付</th>
                    <th>担当者</th>
                    <th>作業内容</th>
                    <th>交換部品</th>
                    <th>費用</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="log : ${machine.maintenanceLogs}">
                    <td th:text="${log.maintenanceDate}"></td>
                    <td th:text="${log.technician}"></td>
                    <td th:text="${log.description}"></td>
                    <td th:text="${log.partsReplaced}">-</td>
                    <td th:text="${#numbers.formatDecimal(log.cost, 0, 'COMMA', 0, 'POINT')} + ' ¥'"></td>
                </tr>
                </tbody>
            </table>

            <div th:if="${#lists.isEmpty(machine.maintenanceLogs)}" class="p-3 text-center text-muted">
                履歴データがありません。
            </div>
        </div>
    </div>
</div>

</body>
</html>